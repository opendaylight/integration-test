# -*- mode: ruby -*-
# vi: set ft=ruby :

# Set memory value (MB) and number of CPU cores here
$MEMORY = "2048"
$CPU = "2"

# Initial Vagrant configuration
Vagrant.configure(2) do |config|

  # ---------------------
  # Shared configurations
  # ---------------------

  # Enables SSH X11 forwarding
  config.ssh.forward_x11 = "true"

  # VirtualBox configuration
  config.vm.provider "virtualbox" do |vb|
    # Set RAM in MB
    vb.memory = $MEMORY
    # Set num CPU cores
    vb.cpus = $CPU
  end

  # LibVirt configuration
  config.vm.provider "libvirt" do |libvirt|
    # Set RAM in MB
    libvirt.memory = $MEMORY
    # Set num CPU cores
    libvirt.cpus = $CPU
  end

  # NFS is fragile, disable it and use rsync
  config.nfs.functional = false

  # Work around but in Vagrant 1.8.5 by using password over SSH auth
  # https://github.com/mitchellh/vagrant/issues/7610
  config.ssh.insert_key = false

  # ---------------------------
  # Configuration for Fedora 24
  # ---------------------------

  # Multi-machine definition for Fedora
  config.vm.define "fedora" do |fedora|
    # Build Vagrant box based on Fedora 24
    fedora.vm.box = "fedora/24-cloud-base"
    # Set hostname of box
    fedora.vm.hostname = "tools-fedora"
    # Use shell provisioner to install additional packages
    fedora.vm.provision "shell", path: "scripts/fedora.sh", privileged: "false"

    # Install OpenDaylight using its Puppet module
    fedora.vm.provision "puppet" do |puppet|
      puppet.module_path = ["modules"]
      puppet.environment_path = "environments"
      puppet.environment = "main"
    end

    # VirtualBox configuration specific to this box
    fedora.vm.provider "virtualbox" do |vb|
      # Name for guest machine
      vb.name = "Integration Tools: Fedora 24"
    end
  end

  # ----------------------------------
  # Configuration for Ubuntu 14.04 LTS
  # ----------------------------------

  # Multi-machine definition for Ubuntu
  config.vm.define "ubuntu" do |ubuntu|
    # Build Vagrant box based on Ubuntu 14.04
    ubuntu.vm.box = "ubuntu/trusty64"
    # Set hostname of box
    ubuntu.vm.hostname = "tools-ubuntu"
    # Use shell provisioner to install additional packages
    ubuntu.vm.provision "shell", path: "scripts/ubuntu.sh"

    # VirtualBox configuration specific to this box
    ubuntu.vm.provider "virtualbox" do |vb|
      # Name for guest machine
      vb.name = "Integration Tools: Ubuntu 14.04"
    end
  end
end
