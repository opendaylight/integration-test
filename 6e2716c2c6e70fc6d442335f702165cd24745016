{
  "comments": [
    {
      "key": {
        "uuid": "3a79b1b5_83f2acd0",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 37,
      "author": {
        "id": 2877
      },
      "writtenOn": "2015-09-11T09:15:03Z",
      "side": 1,
      "message": "This may take significant amount of time (the SSH key exchange part of the connection might be pretty slow on slower networks; may be problematic for performance tests if they need to issue commands to the karaf console in the middle of their timed test case runs) and has an unobvious effect of clobbering the active SSH connection (this may be unexpected and lead to bugs in tests and cumbersome workarounds). Additionally talking to more than one controller is pretty cumbersome as the callers need to repeat the ${controller}, and possibly also ${karaf_port} and ${timeout} in each invocation that needs to talk with the non-default controller.\n\nA better design would separate this action from the actual command sending, allowing for making the time consuming login action in the test suite setup and having only the fairly fast write command here. Also the \"more controllers\" scenario becomes less cluttered as the connection ID is the only thing needed in the \"issue command\" invocation.\n\nSomething is in the works (https://git.opendaylight.org/gerrit/26734) but it is pretty involved (lots of test suites need updating) and my time is right now needed elsewhere. A quickfix could be inspired by that change though: Save the index of the active connection before these 2 lines and do a Switch Connection to the saved index after the \"Close Connection\" line below.",
      "range": {
        "startLine": 36,
        "startChar": 0,
        "endLine": 37,
        "endChar": 47
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_3a73b5b2",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 37,
      "author": {
        "id": 2264
      },
      "writtenOn": "2015-09-11T17:14:28Z",
      "side": 1,
      "message": "I get your point.  This is a nice keyword to issue a basic command on the karaf console.  It is atomic as far as ssh goes, in that it will open and close the ssh connection.  Other ssh connections outside of this should be tracked with their connection index that is returned when you do an Open Connection.\n\nSo, to make this better, and I can do the work sometime next week if needed, I suggest:\n\nadd an additional argument called \"connection_index\" and default it to \"None\".  Then if no index it passed to this keyword, it should work as is.  However, if someone has already opened an ssh connection to the karaf console (see the \"Connect To Controller Karaf\" keyword below) they can pass that connection index to this keyword and skip the \"open connection\"   This will keep this keyword backward compatible and should address the concerns you have brought up.\n\nwhat do you think?\n\n\noh, also if we pass a connection index to this keyword we should skip the \"Close Connection\" step as well.",
      "parentUuid": "3a79b1b5_83f2acd0",
      "range": {
        "startLine": 36,
        "startChar": 0,
        "endLine": 37,
        "endChar": 47
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_dd9ab862",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 37,
      "author": {
        "id": 2877
      },
      "writtenOn": "2015-09-14T15:34:08Z",
      "side": 1,
      "message": "This idea is pretty good in that there will be no need to refactor 20+ tests I don\u0027t have the know-how to correctly check that they were refactored properly.\n\nThis is something I could do myself in 2-3 days. As it has pretty high priority, I guess it is better I will handle it, freeing you for whatever needs your attention more urgently.\n\nOne point is that I will add a pair of Get_Connection/Switch_Connection calls bracketing the body of the method so the \"SSH connection clobbering problem\" will go away.\n\nAnther point is that I want to introduce the concept of \"default connection\" so that a testsuite issuing many commands to just one console does not have to pass a plethora of arguments to the keyword.\n\nOtherwise the \"connection_index\" (well, a better name here would be \"console_index\" to avoid confusion with raw SSH connections) will be passed around.",
      "parentUuid": "3a79b1b5_3a73b5b2",
      "range": {
        "startLine": 36,
        "startChar": 0,
        "endLine": 37,
        "endChar": 47
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_5d21c8f9",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 81,
      "author": {
        "id": 2877
      },
      "writtenOn": "2015-09-14T15:34:08Z",
      "side": 1,
      "message": "I am going to rename this to \"Open Controller Karaf Console\" to make it less likely to be confused with some SSH connection.",
      "range": {
        "startLine": 81,
        "startChar": 0,
        "endLine": 81,
        "endChar": 27
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_da6961bf",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 87,
      "author": {
        "id": 2264
      },
      "writtenOn": "2015-09-11T17:14:28Z",
      "side": 1,
      "message": "per my comment above, we should [Return]    ${connection} in this keyword.",
      "range": {
        "startLine": 80,
        "startChar": 0,
        "endLine": 87,
        "endChar": 58
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_ba5ee510",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 102,
      "author": {
        "id": 2264
      },
      "writtenOn": "2015-09-11T17:14:28Z",
      "side": 1,
      "message": "if the above ideas are acceptable, I think this keyword can be simplified.  I would say this should also accept a connection_index argument as well defaulted to \"None\" and skip the \"Get_Connection\" step.  I see that step as dangerous because someone using this library may not have their \"current\" ssh connection opened to the controller VM anyway.  could be opened to another system.  So if an index is passed in, it can then pass that index to \"Issue Command On Karaf Console\".  If index is None, it can \"Connnect to Controller Karaf\" which now returns an index and then use that index in the same \"Issue Command On Karaf Console\".\n\nIf you want to let this patch sit for a while, I\u0027ll do the work and ammend it here.  I just can\u0027t do it in the next few days.",
      "range": {
        "startLine": 88,
        "startChar": 0,
        "endLine": 102,
        "endChar": 38
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "3a79b1b5_7d1cc4c1",
        "filename": "csit/libraries/KarafKeywords.robot",
        "patchSetId": 3
      },
      "lineNbr": 102,
      "author": {
        "id": 2877
      },
      "writtenOn": "2015-09-14T15:34:08Z",
      "side": 1,
      "message": "When your ideas are implemented, only two lines and a part of third from this keyword are going to survive. The first line will be the [Arguments] (which will get some more arguments added but its current content will survive), the second one is [Documentation] and the part is the one cell that contains \"ROBOT MESSAGE\". :)",
      "parentUuid": "3a79b1b5_ba5ee510",
      "range": {
        "startLine": 88,
        "startChar": 0,
        "endLine": 102,
        "endChar": 38
      },
      "revId": "6e2716c2c6e70fc6d442335f702165cd24745016",
      "serverId": "7fc14799-209e-464c-9743-7a06c2c21a81",
      "unresolved": false
    }
  ]
}